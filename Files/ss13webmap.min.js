var SS13Webmap=function(){function n(){var n={option_1:{},option_2:{}};n.option_2.GPS=function o(){var n=L.rectangle([[0,0],[0,0]],{fill:!1,interactive:!1,color:"#40628a",weight:5}),o=!1;return n.on("remove",function(){o=!0}),n.on("add",function(){o=!1}),f.on("mousemove",function(a){if(!o){var e=Math.floor(a.latlng.lat),i=Math.floor(a.latlng.lng),t=function l(n,o,a){var e={};return e.y=n+Math.abs(a[1][0])+1,e.x=o+1,e}(e,i,s);n.setBounds([[e+1,i],[e,i+1]]),n.bindTooltip(t.x+","+t.y).openTooltip()}}),n.addTo(f)}();var r=L.layerGroup();if(l){for(var c in console.info("%cBuilding Deathmap",d),l){var m=l[c],{url:p}=m,g=a(p,!1);for(var v in g){var y=g[v],h=y.deaths/u;let n=e(y.cords,s);var b=L.rectangle([[n.lat+1,n.lng],[n.lat,n.lng+1]],{fill:!0,color:"#ff0000",stroke:!1,interactive:!1,fillOpacity:h});r.push(b)}}console.info("%cDeathmap built",d)}for(var c in console.info("%cBuilding Map",d),i){m=i[c];var{url:p,z:_,name:M}=m,x=M||"Base Map";i.length>1&&(x="Deck "+_),n.option_1[x]=1===_?L.imageOverlay(p,s).addTo(f):L.imageOverlay(p,s)}if(console.info("%cBuilt Map",d),0==t.length||!t)return console.info("%cNo pipenet found, Returning.",d),void L.control.layers(n.option_1,n.option_2).addTo(f);for(var c in console.info("%cBuilding Pipes",d),t){m=t[c];var{url:p,z:_}=m;x="Pipenet";t.length>1&&(x="Deck "+_),n.option_2[x]=L.imageOverlay(p,s)}console.info("%cPipes built",d),L.control.layers(n.option_1,n.option_2).addTo(f)}function o(){var n={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(o,a,e){n[a]=e}),n}function a(n,o=!0){var a=new XMLHttpRequest;a.open("GET",n,o),a.onload=function(){return JSON.parse(a.responseText)},a.send()}function e(n,o){var a={};return a.lat=n.y-Math.abs(o[1][0])-1,a.lng=n.x-1,a}var i,t,l,r,c,s,f,u=200;const d="color: blue; font-weight:bold; font-size:20px; font-family:Arial;";return{newWebmap:function(a){(function u(n){console.info("%cLoading config:",d),console.info(n),i=n.maps?n.maps:[],t=n.pipenet?n.pipenet:null,l=n.deathmap?n.deathmap:null,s=n.bounds?n.bounds:[[0,0],[-250,250]],r=n.divcontent?n.divcontent:"webmap",c=n.mapconfig?n.mapconfig:null,console.info("%cConfigs out:",d),console.info(i,t,l,s,r,c)})(a),function m(){(f=L.map(r,c)).fitBounds(s),f.setMaxBounds(s),f.attributionControl.setPrefix("SS13 WebMap by AffectedArc07"),console.info("%cMap instance started",d)}(),n(),function p(){f.on("zoom",function(n){var o=n.target._zoom;console.log(o),o>=6?$(".leaflet-image-layer").css("image-rendering","pixelated"):$(".leaflet-image-layer").css("image-rendering","")})}(),$(window).load(function(){setTimeout(function(){const{x:n,y:a,zoom:i}=o();if(n&&a){console.info("%cLoading query",d),console.info(o());let t=e({x:Number(n),y:Number(a)},s);if(i)return void f.flyTo(L.latLng(t.lat,t.lng),Math.min(Number(i),c.maxZoom));f.flyTo(L.latLng(t.lat,t.lng))}},700)})},runFTL:function(n){var o="E",a="tg",e=0,i=!0;n&&(o=n.direction?n.direction:"E",a=n.mode?n.mode:"tg",e=n.speed_modifier?n.speed_modifier:0,i=!n.animate||n.animate);const t=$("#layer1"),l=$("#layer2"),r=$("#layer3"),c={tg:"TG_layer",norm:"layer"};var s=Math.max(80+e,1),f=Math.max(40+e,1),u=Math.max(20+e,1);t.addClass(c[a]+"1"),l.addClass(c[a]+"2"),r.addClass(c[a]+"3"),t.css("animation-name","loop_"+o),l.css("animation-name","loop_"+o),r.css("animation-name","loop_"+o),i&&(t.css("animation-duration",s+"s"),l.css("animation-duration",f+"s"),r.css("animation-duration",u+"s"))}}}();