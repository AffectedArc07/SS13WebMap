var SS13Webmap=function(){function n(){var n={option_1:{},option_2:{}};if(n.option_2.GPS=function o(){var n=L.rectangle([[0,0],[0,0]],{fill:!1,interactive:!1,color:"#40628a",weight:5}),o=!1;return n.on("remove",function(){o=!0}),n.on("add",function(){o=!1}),f.on("mousemove",function(a){if(!o){var e=Math.floor(a.latlng.lat),t=Math.floor(a.latlng.lng),i=function r(n,o,a){var e={};return e.y=n+Math.abs(a[1][0])+1,e.x=o+1,e}(e,t,s);n.setBounds([[e+1,t],[e,t+1]]),n.bindTooltip(i.x+","+i.y).openTooltip()}}),n.addTo(f)}(),r){var l=L.layerGroup();for(var c in console.info("%cBuilding Deathmap",d),r){var m=r[c],{url:p}=m,g=a(p,!1);for(var v in g){var y=g[v],h=y.deaths/u;let n=e(y.cords,s);var M=L.rectangle([[n.lat+1,n.lng],[n.lat,n.lng+1]],{fill:!0,color:"#ff0000",stroke:!1,interactive:!1,fillOpacity:h});l.push(M)}}n.option_2.Deathmap=l,console.info("%cDeathmap built",d)}for(var c in console.info("%cBuilding Map",d),t){m=t[c];var{url:p,z:b,name:_}=m,x=_||"Base Map";t.length>1&&"Base Map"==x&&(x="Deck "+b),n.option_1[x]=1===b?L.imageOverlay(p,s).addTo(f):L.imageOverlay(p,s)}if(console.info("%cBuilt Map",d),0==i.length||!i)return console.info("%cNo pipenet found, Returning.",d),void L.control.layers(n.option_1,n.option_2).addTo(f);for(var c in console.info("%cBuilding Pipes",d),i){m=i[c];var{url:p,z:b}=m;x="Pipenet";i.length>1&&(x="Deck "+b),n.option_2[x]=L.imageOverlay(p,s)}console.info("%cPipes built",d),L.control.layers(n.option_1,n.option_2).addTo(f)}function o(){var n={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(o,a,e){n[a]=e}),n}function a(n,o=!0){var a=new XMLHttpRequest;a.open("GET",n,o),a.onload=function(){return JSON.parse(a.responseText)},a.send()}function e(n,o){var a={lat:0,lng:0};return a.lat=n.y-Math.abs(o[1][0])-1,a.lng=n.x-1,a}var t,i,r,l,c,s,f,u=150;const d="color: blue; font-weight:bold; font-size:15px; font-family:Arial;";return{newWebmap:function(a){(function u(n){console.info("%cLoading config:",d),console.info(n),t=n.maps?n.maps:[],i=n.pipenet?n.pipenet:null,r=n.deathmap?n.deathmap:null,s=n.bounds?n.bounds:[[0,0],[-250,250]],l=n.divcontent?n.divcontent:"webmap",c=n.mapconfig?n.mapconfig:null,console.info("%cConfigs out:",d),console.info(t,i,r,s,l,c)})(a),function m(){(f=L.map(l,c)).fitBounds(s),f.setMaxBounds(s),f.attributionControl.setPrefix("SS13 WebMap by AffectedArc07"),console.info("%cMap instance started",d)}(),n(),function p(){f.on("zoom",function(n){n.target._zoom>=6?$(".leaflet-image-layer").css("image-rendering","pixelated"):$(".leaflet-image-layer").css("image-rendering","")})}(),$(window).load(function(){setTimeout(function(){const{x:n,y:a,zoom:t}=o();if(n&&a){console.info("%cLoading query",d),console.info(o());let i=e({x:Number(n),y:Number(a)},s);if(t)return void f.flyTo(L.latLng(i.lat,i.lng),Math.min(Number(t),c.maxZoom));f.flyTo(L.latLng(i.lat,i.lng))}},Math.floor(700*Math.random()))})},runFTL:function(n){var o="E",a="tg",e=0,t=!0;n&&(o=n.direction?n.direction:"E",a=n.mode?n.mode:"tg",e=n.speed_modifier?n.speed_modifier:0,t=!n.animate||n.animate);const i=$("#layer1"),r=$("#layer2"),l=$("#layer3"),c={tg:"TG_layer",norm:"layer"};i.addClass(c[a]+"1"),r.addClass(c[a]+"2"),l.addClass(c[a]+"3"),i.css("animation-name","loop_"+o),r.css("animation-name","loop_"+o),l.css("animation-name","loop_"+o),t&&(i.css("animation-duration",Math.max(80+e,1)+"s"),r.css("animation-duration",Math.max(40+e,1)+"s"),l.css("animation-duration",Math.max(20+e,1)+"s"))},newMarker:function(n){var o=[],a={};n&&(o=n.coords?n.coords:[0,0],a=n.markercfg?n.markercfg:{});var t=e({x:o[0],y:o[1]},s);L.marker([t.lat,t.lng],a).addTo(f)}}}();